<!DOCTYPE html>
<html>
<head>
  <title>Bachelor Party Tracker</title>
  <!-- 
    NOTE: For production deployment, replace the CDN version with a proper Tailwind CSS build:
    1. Install Tailwind via npm: npm install -D tailwindcss
    2. Initialize it: npx tailwindcss init
    3. Configure content paths in tailwind.config.js
    4. Add Tailwind directives to your CSS
    5. Run build process: npx tailwindcss -i input.css -o output.css
    See: https://tailwindcss.com/docs/installation
  -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
    .modal-content {
      position: relative;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 500px;
      width: 100%;
      background-color: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }
    
    /* Gradient backgrounds for player cards */
    .gradient-1 {
      background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
      color: white;
    }
    .gradient-2 {
      background: linear-gradient(135deg, #0f766e 0%, #134e4a 100%);
      color: white;
    }
    .gradient-3 {
      background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%);
      color: white;
    }
    .gradient-4 {
      background: linear-gradient(135deg, #374151 0%, #111827 100%);
      color: white;
    }
    .gradient-5 {
      background: linear-gradient(135deg, #78350f 0%, #451a03 100%);
      color: white;
    }
    .gradient-6 {
      background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
    }
    .gradient-7 {
      background: linear-gradient(135deg, #4b5563 0%, #1f2937 100%);
      color: white;
    }
    .gradient-8 {
      background: linear-gradient(135deg, #4338ca 0%, #312e81 100%);
      color: white;
    }
    
    /* Player icon animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }
    
    .icon-animation-pulse {
      animation: pulse 2s infinite ease-in-out;
    }
    
    .icon-animation-spin {
      animation: spin 5s infinite linear;
    }
    
    .icon-animation-bounce {
      animation: bounce 1.5s infinite ease-in-out;
    }
    
    .icon-animation-shake {
      animation: shake 1.5s infinite ease-in-out;
    }
    
    /* Custom styles for player cards */
    .player-card {
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .player-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .icon-container {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      margin-right: 8px;
      background-color: rgba(255, 255, 255, 0.2);
    }

    /* Add glowing text animation */
    @keyframes glow {
      0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.5), 0 0 10px rgba(255, 215, 0, 0.3); }
      50% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 30px rgba(255, 215, 0, 0.6), 0 0 40px rgba(255, 215, 0, 0.4); }
      100% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.5), 0 0 10px rgba(255, 215, 0, 0.3); }
    }

    .header-title {
      font-size: 2.5rem;
      font-weight: bold;
      background: linear-gradient(45deg, #2c3e50, #3498db);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: glow 2s ease-in-out infinite;
      text-align: center;
      width: 100%;
      margin: 0 auto;
      padding: 1rem 0;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .main-header {
      background: linear-gradient(to right, rgba(255,255,255,0.95), rgba(255,255,255,0.98));
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
      margin-bottom: 2rem;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen p-4">
    <!-- Main Header - Always visible -->
    <div class="main-header py-4 px-6 rounded-lg shadow-lg mb-6">
      <div class="flex items-center justify-center w-full">
        <i class="fas fa-dice-d20 text-yellow-500 mr-3 text-3xl"></i>
        <h1 class="header-title">No Crying In The Casino</h1>
      </div>
    </div>

    <!-- Navigation Menu Button -->
    <button id="toggleHeader" class="fixed top-4 right-4 z-10 bg-gray-700 hover:bg-gray-800 text-white p-3 rounded-full shadow-lg">
      <i class="fas fa-bars"></i>
    </button>
    
    <!-- Navigation Menu - Hidden by default -->
    <nav class="flex flex-col py-4 px-6 bg-white rounded-lg shadow-sm mb-4 hidden" id="mainNavigation">
      <div class="flex items-center justify-center space-x-6">
        <a href="#" class="flex items-center hover:text-blue-500 transition-colors">
          <i class="fas fa-user-friends mr-2"></i>
          <span>Players</span>
        </a>
        <button id="teamsBtn" class="flex items-center cursor-pointer hover:text-blue-500 transition-colors">
          <i class="fas fa-users mr-2"></i>
          <span>Teams</span>
        </button>
        <button id="createGameBtn" class="flex items-center cursor-pointer hover:text-blue-500 transition-colors">
          <i class="fas fa-dice mr-2"></i>
          <span>Create Game</span>
        </button>
        <button id="gamesManagementBtn" class="flex items-center cursor-pointer hover:text-blue-500 transition-colors">
          <i class="fas fa-history mr-2"></i>
          <span>Games History</span>
        </button>
        <a href="#" class="flex items-center hover:text-blue-500 transition-colors">
          <i class="fas fa-trophy mr-2"></i>
          <span>Leaderboard</span>
        </a>
        <button id="toggleTheme" class="text-gray-700 flex items-center hover:text-blue-500 transition-colors">
          <i class="fas fa-moon mr-2"></i>
          <span>Theme</span>
        </button>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
      <!-- Active Game Section -->
      <div id="activeGamesSection" class="mb-8 flex flex-col">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold">Active Games</h2>
          <button id="viewAllGamesBtn" class="text-blue-500 hover:text-blue-700 flex items-center">
            <span>View All Games</span>
            <i class="fas fa-chevron-right ml-1"></i>
          </button>
        </div>
        
        <div id="homeActiveGamesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" style="display: none;">
          <!-- Active games will be dynamically added here -->
        </div>
        
        <div id="noActiveGamesMessage" class="flex-1 flex flex-col items-center justify-center py-12">
          <i class="fas fa-dice text-blue-300 text-5xl mb-3"></i>
          <p class="text-gray-500 mb-4">No active games in progress</p>
          <button onclick="openCreateGameModal()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
            Start New Game
          </button>
        </div>
      </div>
      
      <div class="flex flex-col md:flex-row gap-6">
        <!-- Player Balances Section -->
        <div class="md:w-2/3 bg-white rounded-lg shadow-sm p-4">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Player Balances</h2>
            <button id="addPlayerBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm flex items-center">
              <i class="fas fa-plus mr-1"></i> Add Player
            </button>
          </div>
          
          <div id="playersGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Player cards will be dynamically generated here -->
          </div>
        </div>
        
        <!-- Leaderboard Section -->
        <div class="md:w-1/3 bg-white rounded-lg shadow-sm p-4">
          <h2 class="text-xl font-bold mb-4">Leaderboard</h2>
          
          <div class="space-y-3" id="leaderboard">
            <!-- Leaderboard items will be dynamically generated here -->
          </div>
        </div>
      </div>
      
      <!-- Recent Games Section -->
      <div class="mt-8">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold">Recent Games</h2>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead class="bg-gray-50 sticky top-0">
                <tr>
                  <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Game</th>
                  <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Players</th>
                  <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Buy-in</th>
                  <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Winner</th>
                  <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th>
                </tr>
              </thead>
              <tbody id="recentGamesTable">
                <!-- Recent games will be dynamically added here -->
              </tbody>
            </table>
            <div id="noRecentGamesMessage" class="py-6 text-center text-gray-500 hidden">
              No completed games yet
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Player Modal -->
  <div id="addPlayerModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Add New Player</h2>
        <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="addPlayerForm">
        <div class="mb-4">
          <label for="playerName" class="block text-gray-700 font-medium mb-2">Player Name</label>
          <input type="text" id="playerName" name="playerName" required
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="flex justify-end">
          <button type="button" id="cancelAddPlayer" class="px-4 py-2 text-gray-700 mr-2">
            Cancel
          </button>
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
            Add Player
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Player Modal -->
  <div id="editPlayerModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Edit Player</h2>
        <button id="closeEditModalBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="editPlayerForm">
        <input type="hidden" id="editPlayerIndex">
        <div class="mb-4">
          <label for="editPlayerName" class="block text-gray-700 font-medium mb-2">Player Name</label>
          <input type="text" id="editPlayerName" name="editPlayerName" required
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-4">
          <label for="editPlayerBalance" class="block text-gray-700 font-medium mb-2">Balance ($)</label>
          <input type="number" id="editPlayerBalance" name="editPlayerBalance" required min="0"
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-4">
          <label for="editPlayerTeam" class="block text-gray-700 font-medium mb-2">Team</label>
          <select id="editPlayerTeam" name="editPlayerTeam"
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">No Team</option>
            <!-- Team options will be populated dynamically -->
          </select>
        </div>
        
        <div class="flex justify-end">
          <button type="button" id="cancelEditPlayer" class="px-4 py-2 text-gray-700 mr-2">
            Cancel
          </button>
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Confirm Deletion</h2>
        <button id="closeConfirmationModalBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <p class="mb-6">Are you sure you want to delete this player? This action cannot be undone.</p>
      
      <div class="flex justify-end">
        <button id="cancelDeletePlayer" class="px-4 py-2 text-gray-700 mr-2">
          Cancel
        </button>
        <button id="confirmDeletePlayer" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Create Game Modal -->
  <div id="createGameModal" class="modal">
    <div class="modal-content max-w-2xl">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">Create New Game</h2>
        <span class="close-modal cursor-pointer text-2xl">&times;</span>
      </div>
      
      <form id="createGameForm">
        <!-- Game Name -->
        <div class="mb-2">
          <label for="gameName" class="block text-gray-700 mb-1">Game Name</label>
          <input type="text" id="gameName" name="gameName" class="w-full px-4 py-2 border rounded-lg bg-gray-100" required>
        </div>
        
        <!-- Buy-in Amount -->
        <div class="mb-2">
          <label for="buyIn" class="block text-gray-700 mb-1">Buy-in Amount ($)</label>
          <input type="number" id="buyIn" name="buyIn" min="0" step="5" class="w-full px-4 py-2 border rounded-lg bg-gray-100" required>
        </div>
        
        <!-- Team-Based Option -->
        <div class="mb-2">
          <label class="flex items-center">
            <input type="checkbox" id="isTeamBased" name="isTeamBased" class="mr-2" onchange="toggleGameTeamSection()">
            <span class="font-medium">Team-Based Game</span>
          </label>
          <p class="text-sm text-gray-600 ml-5">Players will compete as teams for this game.</p>
        </div>
        
        <!-- Player Selection -->
        <div class="mb-2">
          <h3 class="font-medium mb-2">Select Players</h3>
          
          <div class="border rounded-lg p-4 bg-gray-50">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
              <!-- Player checkboxes will be dynamically added here -->
            </div>
            
            <div class="mt-2 text-sm text-gray-600">
              <span id="selectedPlayersCount">0</span> players selected
            </div>
          </div>
        </div>
        
        <!-- Game Teams Section -->
        <div id="gameTeamsSection" class="mb-2 mt-2" style="display: none;">
          <h3 class="font-medium mb-2">Assign Teams for this Game</h3>
          
          <div class="border rounded-lg p-3 bg-gray-50">
            <div id="gameTeamAssignments">
              <!-- Team assignments will be added here -->
            </div>
          </div>
        </div>
        
        <div class="flex justify-end gap-3 mt-4">
          <button type="button" class="cancel-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded">
            Cancel
          </button>
          <button type="button" class="primary-btn bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded">
            Start Game
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- End Game Modal -->
  <div id="endGameModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">End Game</h2>
        <button id="closeEndGameModalBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="endGameForm">
        <div class="mb-4">
          <h3 class="font-medium text-gray-700" id="gameInfoDisplay">Game: <span id="currentGameName"></span> - Buy-in: $<span id="currentGameBuyIn"></span></h3>
          <div id="teamBasedGameInfo" class="mt-2 text-blue-600 text-sm" style="display: none;">
            <i class="fas fa-users mr-1"></i> Team-Based Game
          </div>
        </div>

        <div id="individualWinnerSection" class="mb-4">
          <label for="gameWinner" class="block text-gray-700 font-medium mb-2">Select Winner</label>
          <select id="gameWinner" name="gameWinner" required
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select a player</option>
            <!-- Winner options will be dynamically generated here -->
          </select>
        </div>

        <div id="teamWinnerSection" class="mb-4" style="display: none;">
          <label for="teamWinner" class="block text-gray-700 font-medium mb-2">Select Winning Team</label>
          <select id="teamWinner" name="teamWinner"
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select a team</option>
            <!-- Team winner options will be dynamically generated here -->
          </select>
          
          <div class="mt-3">
            <label class="block text-gray-700 font-medium mb-2">How should winnings be split?</label>
            <div class="flex items-center space-x-4">
              <div class="flex items-center">
                <input type="radio" id="splitEqual" name="splitMethod" value="equal" checked class="h-4 w-4 mr-2">
                <label for="splitEqual" class="text-gray-700">Equal Split</label>
              </div>
              <div class="flex items-center">
                <input type="radio" id="splitCustom" name="splitMethod" value="custom" class="h-4 w-4 mr-2">
                <label for="splitCustom" class="text-gray-700">Custom Split</label>
              </div>
            </div>
          </div>
          
          <div id="customSplitSection" class="mt-3" style="display: none;">
            <p class="text-sm text-gray-500 mb-2">Specify how much each player should receive. Total must equal pot amount.</p>
            <div id="teamPlayerSplits" class="space-y-2">
              <!-- Custom split inputs will be dynamically generated here -->
            </div>
          </div>
        </div>

        <div class="mb-6">
          <label for="totalPot" class="block text-gray-700 font-medium mb-2">Total Pot Amount ($)</label>
          <input type="number" id="totalPot" name="totalPot" required min="0"
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="flex justify-end">
          <button type="button" id="cancelEndGame" class="px-4 py-2 text-gray-700 mr-2">
            Cancel
          </button>
          <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
            End Game & Award Winner
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Current Game Banner (only visible when a game is in progress) -->
  <div id="currentGameBanner" class="fixed bottom-0 left-0 right-0 bg-blue-600 text-white py-3 px-4 flex justify-between items-center" style="display: none;">
    <div class="flex items-center">
      <i class="fas fa-dice mr-2"></i>
      <div>
        <div class="font-medium" id="currentGameDisplay">Game in progress: <span id="activeGameName"></span></div>
        <div class="text-sm text-blue-100">Buy-in: $<span id="activeGameBuyIn"></span> - Players: <span id="activeGamePlayerCount"></span></div>
      </div>
    </div>
    <button id="endGameBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium">
      End Game
    </button>
  </div>

  <!-- Games Management Modal -->
  <div id="gamesManagementModal" class="modal">
    <div class="modal-content max-w-4xl">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Games Management</h2>
        <button id="closeGamesManagementBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="mb-4">
        <div class="flex items-center justify-between">
          <h3 class="font-medium text-lg">Active Game</h3>
          <div class="flex space-x-2">
            <select id="gameSortOption" class="text-sm border rounded px-2 py-1">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
              <option value="highestPot">Highest Pot</option>
              <option value="playerCount">Player Count</option>
            </select>
          </div>
        </div>
        
        <div id="activeGameSection" class="mt-2 p-4 border rounded-lg bg-blue-50">
          <!-- Active game will be shown here -->
        </div>
      </div>
      
      <div>
        <h3 class="font-medium text-lg mb-2">Game History</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-2 px-4 text-left">Game</th>
                <th class="py-2 px-4 text-left">Date</th>
                <th class="py-2 px-4 text-left">Players</th>
                <th class="py-2 px-4 text-left">Buy-in</th>
                <th class="py-2 px-4 text-left">Pot</th>
                <th class="py-2 px-4 text-left">Winner</th>
                <th class="py-2 px-4 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="gamesHistoryTable">
              <!-- Game history will be dynamically added here -->
            </tbody>
          </table>
        </div>
        <div id="noGamesMessage" class="text-center text-gray-500 my-4 hidden">
          No games have been played yet. Start your first game!
        </div>
      </div>
    </div>
  </div>

  <!-- Game Details Modal -->
  <div id="gameDetailsModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Game Details</h2>
        <button id="closeGameDetailsBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div id="gameDetailsContent">
        <!-- Game details will be dynamically added here -->
      </div>
      
      <div class="flex justify-end mt-4">
        <button id="closeGameDetailsAction" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Teams Modal -->
  <div id="teamsModal" class="modal">
    <div class="modal-content max-w-2xl">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Manage Teams</h2>
        <button id="closeTeamsModalBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="flex justify-between items-center mb-4">
        <p class="text-sm text-gray-500">Create and manage teams for group play.</p>
        <button id="addTeamBtn" class="bg-blue-500 text-white px-3 py-1 rounded text-sm flex items-center">
          <i class="fas fa-plus mr-1"></i> Add Team
        </button>
      </div>
      
      <div id="teamsList" class="space-y-3 mb-4">
        <!-- Teams will be dynamically added here -->
      </div>
      
      <div id="noTeamsMessage" class="text-center py-6 text-gray-500">
        No teams created yet. Click "Add Team" to create your first team.
      </div>
      
      <div class="flex justify-end">
        <button id="closeTeamsAction" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">
          Close
        </button>
      </div>
    </div>
  </div>
  
  <!-- Add/Edit Team Modal -->
  <div id="teamFormModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold" id="teamFormTitle">Add New Team</h2>
        <button id="closeTeamFormBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="teamForm">
        <input type="hidden" id="editTeamIndex" value="-1">
        <div class="mb-4">
          <label for="teamName" class="block text-gray-700 font-medium mb-2">Team Name</label>
          <input type="text" id="teamName" name="teamName" required
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-4">
          <label for="teamColor" class="block text-gray-700 font-medium mb-2">Team Color</label>
          <select id="teamColor" name="teamColor" required
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="blue-600">Blue</option>
            <option value="red-600">Red</option>
            <option value="green-600">Green</option>
            <option value="yellow-500">Yellow</option>
            <option value="purple-600">Purple</option>
            <option value="pink-500">Pink</option>
            <option value="indigo-600">Indigo</option>
            <option value="gray-600">Gray</option>
          </select>
        </div>
        
        <div class="flex justify-end">
          <button type="button" id="cancelTeamForm" class="px-4 py-2 text-gray-700 mr-2">
            Cancel
          </button>
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
            Save Team
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Data model
    let players = [];
    let games = [];
    let teams = [];
    let activeGames = [];
    const STARTING_BALANCE = 300;
    let currentPlayerIndex = -1;
    let currentTeamIndex = -1;
    let currentGameIndex = -1;
    
    // Initialize with sample player data
    const samplePlayers = [
      { id: 1, name: "Freebs", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 2, name: "Mike A", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 3, name: "Mike S", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 4, name: "Matt M", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 5, name: "Chris", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 6, name: "Adam", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 7, name: "Donnie", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 8, name: "Stephen", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 9, name: "Sam", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 10, name: "Skibicki", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 11, name: "Davis", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 12, name: "Avas", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 13, name: "Luke", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 14, name: "Chris Barks", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 15, name: "Perugini", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 },
      { id: 16, name: "Dorey", balance: 300, transactions: [], gamesPlayed: 0, gamesWon: 0, totalWinnings: 0 }
    ];
    
    // IMPORTANT: Force initialize players with sample data to ensure we have data to display
    players = [...samplePlayers];
    
    // Core data management functions
    // Load players from localStorage
    window.loadPlayers = function() {
        console.log('Loading players from localStorage');
        
        // FORCE RESET: Clear localStorage and use sample data
        console.log('Forcing reset of player data with sample players');
        window.players = [...samplePlayers]; // Make a copy to avoid reference issues
        players = window.players; // Ensure the global variable is updated
        
        // Save to localStorage
        localStorage.setItem('bachelorPartyPlayers', JSON.stringify(players));
        console.log('Saved sample players to localStorage:', players);
        
        /* 
        // Original localStorage loading (commented out for now)
        const savedPlayers = localStorage.getItem('bachelorPartyPlayers');
        
        if (savedPlayers) {
          console.log('Found saved players in localStorage');
          window.players = JSON.parse(savedPlayers);
          players = window.players; // Ensure the global variable is updated
          console.log('Loaded players:', players);
        } else if (players.length === 0) { // Only use sample data if no players exist
          console.log('No saved players found and no existing players, initializing with sample players');
          // Initialize with sample players if none exist
          window.players = samplePlayers;
          players = window.players; // Ensure the global variable is updated
          console.log('Sample players loaded:', players);
          savePlayers();
        } else {
          console.log('Using existing players:', players);
          // Update localStorage with existing data
          savePlayers();
        }
        */
    };
    
    // Save players to localStorage
    window.savePlayers = function() {
        console.log('Saving players to localStorage');
        localStorage.setItem('bachelorPartyPlayers', JSON.stringify(players));
    };
    
    // Load teams from localStorage
    window.loadTeams = function() {
        console.log('Loading teams from localStorage');
        const savedTeams = localStorage.getItem('bachelorPartyTeams');
        
        if (savedTeams) {
          window.teams = JSON.parse(savedTeams);
        } else {
          window.teams = [];
          saveTeams();
        }
    };
    
    // Save teams to localStorage
    window.saveTeams = function() {
        localStorage.setItem('bachelorPartyTeams', JSON.stringify(teams));
    };
    
    // Load games from localStorage
    window.loadGames = function() {
        const savedGames = localStorage.getItem('bachelorPartyGames');
        
        if (savedGames) {
          window.games = JSON.parse(savedGames);
        } else {
          window.games = [];
        }
    };
    
    // Load active games from localStorage
    window.loadActiveGames = function() {
        const savedActiveGames = localStorage.getItem('bachelorPartyActiveGames');
        
        if (savedActiveGames) {
          window.activeGames = JSON.parse(savedActiveGames);
        } else {
          window.activeGames = [];
        }
    };
    
    // Save active games to localStorage
    window.saveActiveGames = function() {
        localStorage.setItem('bachelorPartyActiveGames', JSON.stringify(activeGames));
    };
    
    // Render player leaderboard
    window.renderPlayerLeaderboard = function() {
        console.log('Rendering player leaderboard');
        const leaderboardElement = document.getElementById('leaderboard');
        if (!leaderboardElement) return;
        
        leaderboardElement.innerHTML = '';
        
        if (players.length === 0) {
          leaderboardElement.innerHTML = '<div class="text-center py-4 text-gray-500">No players added yet</div>';
          return;
        }
        
        // Create a copy of players array for sorting
        const sortedPlayers = [...players].sort((a, b) => {
          // Sort by total winnings (descending)
          return (b.totalWinnings || 0) - (a.totalWinnings || 0);
        });
        
        sortedPlayers.forEach((player, index) => {
          const leaderboardItem = document.createElement('div');
          leaderboardItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded';
          
          const ranking = index + 1;
          const medal = ranking <= 3 ? ['🥇', '🥈', '🥉'][ranking - 1] : `${ranking}.`;
          
          leaderboardItem.innerHTML = `
            <div class="flex items-center">
              <span class="text-lg mr-2">${medal}</span>
              <span class="font-medium">${player.name}</span>
            </div>
            <div class="text-right">
              <div class="text-lg font-bold">$${(player.totalWinnings || 0).toFixed(0)}</div>
              <div class="text-xs text-gray-500">${player.gamesWon || 0} wins</div>
            </div>
          `;
          
          leaderboardElement.appendChild(leaderboardItem);
        });
    };
    
    // Check for active games
    window.checkForActiveGames = function() {
        const activeGamesContainer = document.getElementById('homeActiveGamesContainer');
        const noActiveGamesMessage = document.getElementById('noActiveGamesMessage');
        
        if (activeGames && activeGames.length > 0) {
          activeGamesContainer.style.display = 'grid';
          noActiveGamesMessage.style.display = 'none';
        } else {
          activeGamesContainer.style.display = 'none';
          noActiveGamesMessage.style.display = 'flex';
        }
    };
    
    // Toggle team section in game creation
    window.toggleGameTeamSection = function() {
      const isTeamBased = document.getElementById('isTeamBased').checked;
      const teamSection = document.getElementById('gameTeamsSection');
      
      if (isTeamBased) {
        teamSection.style.display = 'block';
        
        // Populate teams if they don't exist
        const teamAssignments = document.getElementById('gameTeamAssignments');
        if (teamAssignments.children.length === 0) {
          // Create at least two default teams
          createGameTeam('Team A', 'blue-600');
          createGameTeam('Team B', 'red-600');
        }
      } else {
        teamSection.style.display = 'none';
      }
    };
    
    // Function to create a new game team
    window.createGameTeam = function(name, color) {
      const teamId = Date.now() + '-' + Math.floor(Math.random() * 1000);
      const teamContainer = document.createElement('div');
      teamContainer.className = 'game-team-container border-b pb-3 mb-3 last:border-b-0 last:mb-0 last:pb-0';
      teamContainer.dataset.teamId = teamId;
      
      teamContainer.innerHTML = `
        <div class="flex justify-between items-center mb-2">
          <div class="flex">
            <label for="teamName-${teamId}" class="sr-only">Team Name</label>
            <input type="text" id="teamName-${teamId}" class="game-team-name border-0 bg-transparent font-medium focus:outline-none focus:ring-0" value="${name}" placeholder="Team Name">
            <select class="game-team-color border-0 bg-transparent text-${color} focus:outline-none focus:ring-0 ml-2">
              <option value="blue-600" ${color === 'blue-600' ? 'selected' : ''}>Blue</option>
              <option value="red-600" ${color === 'red-600' ? 'selected' : ''}>Red</option>
              <option value="green-600" ${color === 'green-600' ? 'selected' : ''}>Green</option>
              <option value="yellow-500" ${color === 'yellow-500' ? 'selected' : ''}>Yellow</option>
              <option value="purple-600" ${color === 'purple-600' ? 'selected' : ''}>Purple</option>
            </select>
          </div>
          <button type="button" class="text-red-500 hover:text-red-700 remove-team-btn">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="team-players grid grid-cols-2 gap-2">
          ${players.map((player, idx) => `
            <label class="flex items-center cursor-pointer bg-gray-50 border rounded-md px-2 py-1 text-sm hover:bg-gray-100">
              <input type="checkbox" id="teamPlayer-${teamId}-${player.id}" name="team-${teamId}-players" value="${player.id}" class="h-4 w-4 mr-2 team-player-checkbox" data-player-name="${player.name}">
              <span>${player.name}</span>
            </label>
          `).join('')}
        </div>
      `;
      
      // Add to the team assignments container
      document.getElementById('gameTeamAssignments').appendChild(teamContainer);
      
      // Add remove team button handler
      const removeBtn = teamContainer.querySelector('.remove-team-btn');
      if (removeBtn) {
        removeBtn.addEventListener('click', function() {
          // Check if there are more than 2 teams before removing
          const teamContainers = document.querySelectorAll('.game-team-container');
          if (teamContainers.length > 2) {
            teamContainer.remove();
          } else {
            alert('You must have at least 2 teams for a team-based game.');
          }
        });
      }
    };
    
    // Render teams list in the teams modal
    window.renderTeamsList = function() {
      console.log('Rendering teams list');
      const teamsListElement = document.getElementById('teamsList');
      const noTeamsMessage = document.getElementById('noTeamsMessage');
      
      if (!teamsListElement) return;
      
      teamsListElement.innerHTML = '';
      
      if (teams.length === 0) {
        teamsListElement.style.display = 'none';
        noTeamsMessage.style.display = 'block';
        return;
      }
      
      teamsListElement.style.display = 'block';
      noTeamsMessage.style.display = 'none';
      
      teams.forEach((team, index) => {
        const teamItem = document.createElement('div');
        teamItem.className = 'bg-white border rounded-lg p-4';
        
        // Get team members
        const teamMembers = players.filter(player => player.teamId === team.id);
        
        teamItem.innerHTML = `
          <div class="flex justify-between items-start">
            <div class="flex items-center">
              <div class="h-6 w-6 rounded-full bg-${team.color || 'blue-600'} mr-3"></div>
              <h3 class="font-medium">${team.name}</h3>
            </div>
            <div class="flex space-x-2">
              <button class="edit-team-btn text-blue-500 hover:text-blue-700 p-1" data-index="${index}">
                <i class="fas fa-pencil-alt"></i>
              </button>
              <button class="delete-team-btn text-red-500 hover:text-red-700 p-1" data-index="${index}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          
          <div class="mt-3">
            <h4 class="text-sm text-gray-600 mb-1">Team Members (${teamMembers.length})</h4>
            <div class="flex flex-wrap gap-1">
              ${teamMembers.length > 0 
                ? teamMembers.map(player => `
                  <span class="text-xs bg-gray-100 px-2 py-1 rounded">${player.name}</span>
                `).join('')
                : '<span class="text-xs text-gray-500">No members assigned</span>'
              }
            </div>
          </div>
        `;
        
        teamsListElement.appendChild(teamItem);
        
        // Add event listeners
        const editBtn = teamItem.querySelector('.edit-team-btn');
        if (editBtn) {
          editBtn.addEventListener('click', function() {
            openEditTeamModal(index);
          });
        }
        
        const deleteBtn = teamItem.querySelector('.delete-team-btn');
        if (deleteBtn) {
          deleteBtn.addEventListener('click', function() {
            // Check if team has members before deleting
            if (teamMembers.length > 0) {
              if (confirm(`This team has ${teamMembers.length} members. Are you sure you want to delete it?`)) {
                deleteTeam(index);
              }
            } else {
              deleteTeam(index);
            }
          });
        }
      });
    };
    
    // Open edit team modal
    window.openEditTeamModal = function(index) {
      currentTeamIndex = index;
      
      if (index >= 0 && index < teams.length) {
        const team = teams[index];
        
        document.getElementById('teamFormTitle').textContent = 'Edit Team';
        document.getElementById('editTeamIndex').value = index;
        document.getElementById('teamName').value = team.name;
        document.getElementById('teamColor').value = team.color || 'blue-600';
        
        document.getElementById('teamFormModal').style.display = 'block';
      }
    };
    
    // Delete team
    window.deleteTeam = function(index) {
      if (index >= 0 && index < teams.length) {
        const team = teams[index];
        
        // Remove team reference from players
        players.forEach(player => {
          if (player.teamId === team.id) {
            player.teamId = '';
          }
        });
        
        // Remove team
        teams.splice(index, 1);
        
        // Save changes
        saveTeams();
        savePlayers();
        
        // Update UI
        renderTeamsList();
      }
    };
    
    // Function to render games management
    window.renderGamesManagement = function() {
      console.log('Rendering games management');
      
      // Update active games section
      const activeGameSection = document.getElementById('activeGameSection');
      
      if (activeGames.length === 0) {
        activeGameSection.innerHTML = '<div class="text-center py-4 text-gray-500">No active games</div>';
      } else {
        // Just show the first active game for now
        const game = activeGames[0];
        
        // Format date
        const gameDate = new Date(game.date);
        const formattedDate = `${gameDate.toLocaleDateString()} ${gameDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        
        activeGameSection.innerHTML = `
          <div class="relative bg-white rounded-lg shadow-sm border-l-4 border-blue-500 px-4 py-3">
            <div class="flex justify-between">
              <div>
                <h3 class="font-bold text-lg">${game.name}</h3>
                <div class="text-sm text-gray-600">Started: ${formattedDate}</div>
                <div class="mt-2 flex items-center space-x-4">
                  <div>
                    <span class="text-sm text-gray-600">Players:</span>
                    <span class="font-medium">${game.players.length}</span>
                  </div>
                  <div>
                    <span class="text-sm text-gray-600">Buy-in:</span>
                    <span class="font-medium">$${game.buyIn}</span>
                  </div>
                  ${game.isTeamBased ? 
                    `<div class="rounded-full bg-blue-100 text-blue-800 px-2 py-0.5 text-xs">
                      Team-Based
                    </div>` : ''
                  }
                </div>
              </div>
              <div>
                <button class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded" 
                  onclick="openEndGameModal('${game.id}')">
                  End Game
                </button>
              </div>
            </div>
          </div>
        `;
      }
      
      // Update games history
      const gamesHistoryTable = document.getElementById('gamesHistoryTable');
      const noGamesMessage = document.getElementById('noGamesMessage');
      
      if (!gamesHistoryTable) return;
      
      gamesHistoryTable.innerHTML = '';
      
      // Get all completed games
      const completedGames = games.filter(game => !game.isActive);
      
      if (completedGames.length === 0) {
        noGamesMessage.style.display = 'block';
        return;
      }
      
      noGamesMessage.style.display = 'none';
      
      // Sort games based on selected option
      const sortOption = document.getElementById('gameSortOption').value;
      
      let sortedGames = [...completedGames];
      
      switch(sortOption) {
        case 'newest':
          sortedGames.sort((a, b) => new Date(b.date) - new Date(a.date));
          break;
        case 'oldest':
          sortedGames.sort((a, b) => new Date(a.date) - new Date(b.date));
          break;
        case 'highestPot':
          sortedGames.sort((a, b) => (b.buyIn * b.players.length) - (a.buyIn * a.players.length));
          break;
        case 'playerCount':
          sortedGames.sort((a, b) => b.players.length - a.players.length);
          break;
      }
      
      // Render each game
      sortedGames.forEach(game => {
        const row = document.createElement('tr');
        
        // Format date
        const gameDate = new Date(game.date);
        const formattedDate = `${gameDate.toLocaleDateString()} ${gameDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        
        // Calculate pot size
        const potSize = game.buyIn * game.players.length;
        
        // Get winner info
        let winnerDisplay = 'No winner';
        
        if (game.isTeamBased && game.teamWinners && game.teamWinners.length > 0) {
          winnerDisplay = `Team: ${game.teamWinners[0].name}`;
        } else if (game.winners && game.winners.length > 0) {
          winnerDisplay = game.winners[0].name;
        }
        
        row.className = 'hover:bg-gray-50';
        row.innerHTML = `
          <td class="py-2 px-4">${game.name}</td>
          <td class="py-2 px-4">${formattedDate}</td>
          <td class="py-2 px-4">${game.players.length}</td>
          <td class="py-2 px-4">$${game.buyIn}</td>
          <td class="py-2 px-4">$${potSize}</td>
          <td class="py-2 px-4">${winnerDisplay}</td>
          <td class="py-2 px-4">
            <button onclick="viewGameDetails('${game.id}')" class="text-blue-500 hover:text-blue-700">
              <i class="fas fa-info-circle"></i>
            </button>
          </td>
        `;
        
        gamesHistoryTable.appendChild(row);
      });
    };
    
    // Populate player selection in create game modal
    window.populatePlayerSelection = function() {
      console.log('Populating player selection');
      const playerSelection = document.querySelector('#createGameModal .grid');
      if (!playerSelection) return;
      
      // Clear previous selections
      playerSelection.innerHTML = '';
      
      // No players message
      if (players.length === 0) {
        playerSelection.innerHTML = '<div class="col-span-2 text-center py-2 text-gray-500">No players available. Please add players first.</div>';
        return;
      }
      
      // Add player checkboxes
      players.forEach((player, i) => {
        const checkbox = document.createElement('div');
        checkbox.innerHTML = `
          <label for="player-${i}-selection" class="flex items-center cursor-pointer bg-white border rounded-md px-3 py-2 w-full hover:bg-blue-50">
            <input type="checkbox" id="player-${i}-selection" name="players" value="${player.id}" class="h-5 w-5 mr-3 player-checkbox" 
              data-player-name="${player.name}" data-player-balance="${player.balance}">
            <span>${player.name} ($${player.balance})</span>
          </label>
        `;
        playerSelection.appendChild(checkbox);
      });
      
      // Add change event listeners to checkboxes
      playerSelection.querySelectorAll('.player-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          // Count selected players
          const selectedCount = playerSelection.querySelectorAll('.player-checkbox:checked').length;
          document.getElementById('selectedPlayersCount').textContent = selectedCount;
        });
      });
    };
    
    // Render recent games
    window.renderRecentGames = function() {
        const recentGamesTable = document.getElementById('recentGamesTable');
        const noRecentGamesMessage = document.getElementById('noRecentGamesMessage');
        
        if (!recentGamesTable) return;
        
        recentGamesTable.innerHTML = '';
        
        // Filter for completed games and sort by date (newest first)
        const completedGames = games.filter(game => !game.isActive)
          .sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (completedGames.length === 0) {
          noRecentGamesMessage.style.display = 'block';
          return;
        }
        
        noRecentGamesMessage.style.display = 'none';
        
        completedGames.forEach(game => {
          const row = document.createElement('tr');
          
          // Format date
          const gameDate = new Date(game.date);
          const formattedDate = `${gameDate.toLocaleDateString()} ${gameDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
          
          // Get winner info
          let winnerDisplay = '';
          if (game.isTeamBased && game.teamWinners && game.teamWinners.length > 0) {
            winnerDisplay = `Team: ${game.teamWinners[0].name}`;
          } else if (game.winners && game.winners.length > 0) {
            winnerDisplay = game.winners[0].name;
          } else {
            winnerDisplay = 'No winner';
          }
          
          row.className = 'hover:bg-gray-50';
          row.innerHTML = `
            <td class="py-3 px-3 border-t">${game.name}</td>
            <td class="py-3 px-3 border-t">${formattedDate}</td>
            <td class="py-3 px-3 border-t">${game.players.length}</td>
            <td class="py-3 px-3 border-t">$${game.buyIn}</td>
            <td class="py-3 px-3 border-t">${winnerDisplay}</td>
            <td class="py-3 px-3 border-t">
              <button onclick="viewGameDetails('${game.id}')" class="text-blue-500 hover:text-blue-700">
                <i class="fas fa-info-circle"></i>
              </button>
            </td>
          `;
          
          recentGamesTable.appendChild(row);
        });
    };
    
    // Function to create a gradient player card
    window.renderPlayerWithStyle = function(player, index) {
      console.log(`Generating card for ${player.name}`);
      
      if (!player) {
        console.error('Invalid player data passed to renderPlayerWithStyle');
        return '<div class="player-card bg-red-100 p-4 rounded-lg shadow-sm">Error: Invalid player data</div>';
      }
      
      // Get deterministic style based on player name
      const style = getPlayerStyle(player.name, index);
      
      // Calculate win rate with fallbacks for missing data
      const gamesPlayed = player.gamesPlayed || 0;
      const gamesWon = player.gamesWon || 0; 
      const totalWinnings = player.totalWinnings || 0;
      const winRate = gamesPlayed > 0 ? (gamesWon / gamesPlayed * 100).toFixed(0) : 0;
      
      return `
      <div class="player-card ${style.gradient} p-4 rounded-lg shadow-sm">
        <div class="flex justify-between items-start mb-3">
          <div class="flex items-center">
            <div class="icon-container ${style.animation}">
              <i class="fas fa-user"></i>
            </div>
            <h3 class="font-bold">${player.name}</h3>
          </div>
          <div class="flex space-x-2">
            <button class="edit-player-btn text-white bg-opacity-20 bg-white hover:bg-opacity-30 rounded-full h-6 w-6 flex items-center justify-center" data-index="${index}">
              <i class="fas fa-pencil-alt text-xs"></i>
            </button>
            <button class="delete-player-btn text-white bg-opacity-20 bg-white hover:bg-opacity-30 rounded-full h-6 w-6 flex items-center justify-center" data-index="${index}">
              <i class="fas fa-trash text-xs"></i>
            </button>
          </div>
        </div>
        
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm text-white text-opacity-80">Balance</span>
          <span class="font-bold text-lg">$${(player.balance || 0).toFixed(2)}</span>
        </div>
        
        <div class="grid grid-cols-2 gap-2 text-sm">
          <div class="bg-white bg-opacity-10 p-2 rounded">
            <div class="flex justify-between">
              <span class="text-white text-opacity-80">Games</span>
              <span class="font-medium">${gamesPlayed}</span>
            </div>
          </div>
          <div class="bg-white bg-opacity-10 p-2 rounded">
            <div class="flex justify-between">
              <span class="text-white text-opacity-80">Wins</span>
              <span class="font-medium">${gamesWon}</span>
            </div>
          </div>
          <div class="bg-white bg-opacity-10 p-2 rounded">
            <div class="flex justify-between">
              <span class="text-white text-opacity-80">Win Rate</span>
              <span class="font-medium">${winRate}%</span>
            </div>
          </div>
          <div class="bg-white bg-opacity-10 p-2 rounded">
            <div class="flex justify-between">
              <span class="text-white text-opacity-80">Winnings</span>
              <span class="font-medium">$${totalWinnings.toFixed(0)}</span>
            </div>
          </div>
        </div>
      </div>
      `;
    };
    
    // Animation and gradient arrays
    const iconAnimations = [
      'icon-animation-pulse',
      'icon-animation-spin',
      'icon-animation-bounce',
      'icon-animation-shake'
    ];
    
    const gradientClasses = [
      'gradient-1',
      'gradient-2',
      'gradient-3',
      'gradient-4',
      'gradient-5',
      'gradient-6',
      'gradient-7',
      'gradient-8'
    ];
    
    // Function to get deterministic animation and gradient based on player name
    function getPlayerStyle(name, index) {
      // Handle edge case of null/undefined name
      if (!name) {
        console.warn('No name provided to getPlayerStyle, using fallback');
        name = 'Player' + (index || 0);
      }
      
      // Use the sum of character codes to create a deterministic seed
      let seed = 0;
      for (let i = 0; i < name.length; i++) {
        seed += name.charCodeAt(i);
      }
      
      // Get animation and gradient based on seed and index
      const animationIndex = (seed % iconAnimations.length);
      const gradientIndex = (seed + (index || 0)) % gradientClasses.length;
      
      return {
        animation: iconAnimations[animationIndex],
        gradient: gradientClasses[gradientIndex]
      };
    }

    // Function to open the create game modal
    function openCreateGameModal() {
      console.log('Opening create game modal');
      document.getElementById('createGameModal').style.display = 'block';
      populatePlayerSelection();
    }
    
    // Make it available in the global scope
    window.openCreateGameModal = openCreateGameModal;

    // Initialize app on load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM fully loaded, initializing app');
      
      // Header toggle functionality
      const toggleHeaderBtn = document.getElementById('toggleHeader');
      const mainNavigation = document.getElementById('mainNavigation');
      
      if (toggleHeaderBtn && mainNavigation) {
        toggleHeaderBtn.addEventListener('click', function() {
          mainNavigation.classList.toggle('hidden');
        });
      }
      
      // Check if HTML elements exist
      const elements = {
        playersGrid: document.getElementById('playersGrid'),
        leaderboard: document.getElementById('leaderboard'),
        recentGamesTable: document.getElementById('recentGamesTable'),
        homeActiveGamesContainer: document.getElementById('homeActiveGamesContainer'),
        noActiveGamesMessage: document.getElementById('noActiveGamesMessage')
      };
      
      console.log('Checking important elements:');
      Object.entries(elements).forEach(([name, element]) => {
        console.log(`- ${name}: ${element ? 'Found' : 'MISSING'}`);
      });
      
      // Load data
      console.log('Loading data...');
      loadPlayers();
      loadTeams();
      loadGames();
      loadActiveGames();
      
      // Render UI
      console.log('Rendering UI components...');
      renderPlayerBalances();
      renderPlayerLeaderboard();
      renderRecentGames();
      checkForActiveGames();
      
      // Set up all button click handlers
      console.log('Setting up click handlers...');
      setupClickHandlers();
      
      console.log('Initialization complete');
    });
    
    // Immediate initialization - don't wait for events
    (function() {
      console.log('IMMEDIATE INITIALIZATION - Running without waiting for DOMContentLoaded');
      
      // Clear localStorage of players to start fresh
      localStorage.removeItem('bachelorPartyPlayers');
      
      // Initialize with our sample data
      window.players = [...samplePlayers];
      
      // Set up interval to check if DOM is ready
      const checkInterval = setInterval(function() {
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
          console.log('Document ready, initializing app immediately');
          clearInterval(checkInterval);
          
          // Save players to localStorage
          localStorage.setItem('bachelorPartyPlayers', JSON.stringify(players));
          console.log('Saved players to localStorage from immediate init');
          
          // Render UI if possible
          if (document.getElementById('playersGrid')) {
            console.log('Found playersGrid, rendering players immediately');
            renderPlayerBalances();
            renderPlayerLeaderboard();
          } else {
            console.log('PlayersGrid not found yet, will wait for DOMContentLoaded event');
          }
        }
      }, 100); // Check every 100ms
    })();

    // Function to set up all click handlers in one place
    function setupClickHandlers() {
      console.log('Setting up all click handlers');
      
      // Navigation buttons
      const createGameBtn = document.getElementById('createGameBtn');
      if (createGameBtn) {
        createGameBtn.addEventListener('click', function() {
          console.log('Create Game button clicked');
          openCreateGameModal();
        });
      }
      
      const viewAllGamesBtn = document.getElementById('viewAllGamesBtn');
      if (viewAllGamesBtn) {
        viewAllGamesBtn.addEventListener('click', function() {
          console.log('View All Games button clicked');
          document.getElementById('gamesManagementModal').style.display = 'block';
          renderGamesManagement();
        });
      }
      
      const gamesManagementBtn = document.getElementById('gamesManagementBtn');
      if (gamesManagementBtn) {
        gamesManagementBtn.addEventListener('click', function() {
          console.log('Games Management button clicked');
          document.getElementById('gamesManagementModal').style.display = 'block';
          renderGamesManagement();
        });
      }
      
      const teamsBtn = document.getElementById('teamsBtn');
      if (teamsBtn) {
        teamsBtn.addEventListener("click", function() {
          console.log('Teams button clicked');
          document.getElementById('teamsModal').style.display = 'block';
          renderTeamsList();
        });
      }
      
      const addPlayerBtn = document.getElementById('addPlayerBtn');
      if (addPlayerBtn) {
        addPlayerBtn.addEventListener('click', function() {
          console.log('Add Player button clicked');
          document.getElementById('addPlayerModal').style.display = 'block';
        });
      }
      
      // "Start New Game" button in the no active games section
      const startNewGameBtn = document.querySelector('#noActiveGamesMessage button');
      if (startNewGameBtn) {
        startNewGameBtn.addEventListener('click', function() {
          console.log('Start New Game button clicked');
          openCreateGameModal();
        });
      }
      
      // Modal buttons - Create Game
      const startGameBtn = document.querySelector('#createGameModal .primary-btn');
      if (startGameBtn) {
        startGameBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Start Game button in modal clicked');
          createNewGame();
        });
      }
      
      const cancelCreateGameBtn = document.querySelector('#createGameModal .cancel-btn');
      if (cancelCreateGameBtn) {
        cancelCreateGameBtn.addEventListener('click', function() {
          console.log('Cancel Create Game button clicked');
          document.getElementById('createGameModal').style.display = 'none';
          document.getElementById('createGameForm').reset();
          const selectedPlayersCountElement = document.getElementById('selectedPlayersCount');
          if (selectedPlayersCountElement) selectedPlayersCountElement.textContent = '0';
          document.getElementById('gameTeamsSection').style.display = 'none';
          document.getElementById('gameTeamAssignments').innerHTML = '';
        });
      }
      
      // Team-Based checkbox in Create Game modal
      const isTeamBasedCheckbox = document.getElementById('isTeamBased');
      if (isTeamBasedCheckbox) {
        isTeamBasedCheckbox.addEventListener('change', function() {
          toggleGameTeamSection();
        });
      }
      
      // Set up close buttons for all modals
      setupModalCloseButtons();
      
      // Replace any remaining onclick attributes with proper event listeners
      replaceOnClickAttributes();
    }

    // Function to create a new game
    function createNewGame() {
      // Get form values
      const gameName = document.getElementById('gameName').value.trim();
      const buyIn = parseFloat(document.getElementById('buyIn').value);
      const isTeamBased = document.getElementById('isTeamBased').checked;
      
      // Validate inputs
      if (!gameName) {
        alert('Please enter a game name');
        return;
      }
      
      if (isNaN(buyIn) || buyIn <= 0) {
        alert('Please enter a valid buy-in amount');
        return;
      }
      
      // Get selected players
      const selectedPlayers = [];
      document.querySelectorAll('.player-checkbox:checked').forEach(checkbox => {
        selectedPlayers.push({
          id: parseInt(checkbox.value),
          name: checkbox.dataset.playerName,
          balance: parseFloat(checkbox.dataset.playerBalance || checkbox.dataset.balance || 0)
        });
      });
      
      if (selectedPlayers.length < 2) {
        alert('Please select at least 2 players');
        return;
      }
      
      // For team-based games, validate team assignments
      let teams = [];
      if (isTeamBased) {
        // Get all team containers
        const teamContainers = document.querySelectorAll('.game-team-container');
        if (teamContainers.length < 2) {
          alert('Please create at least 2 teams');
          return;
        }
        
        // Validate each team has at least one player
        let validTeams = true;
        teamContainers.forEach(container => {
          const teamId = container.dataset.teamId;
          const teamName = container.querySelector('.game-team-name').value;
          const teamColor = container.querySelector('.game-team-color').value;
          
          // Get players in this team
          const teamPlayers = [];
          container.querySelectorAll('.team-player-checkbox:checked').forEach(checkbox => {
            const playerId = parseInt(checkbox.value);
            const playerName = checkbox.dataset.playerName;
            
            // Find player data in selected players
            const player = selectedPlayers.find(p => p.id === playerId);
            if (player) {
              teamPlayers.push({
                id: playerId,
                name: playerName
              });
            }
          });
          
          if (teamPlayers.length === 0) {
            alert(`Team ${teamName} has no players assigned`);
            validTeams = false;
            return false;
          }
          
          teams.push({
            id: teamId,
            name: teamName,
            color: teamColor,
            players: teamPlayers
          });
        });
        
        if (!validTeams) return;
      }
      
      // Create game object
      const gameId = Date.now().toString();
      const newGame = {
        id: gameId,
        name: gameName,
        date: new Date().toISOString(),
        buyIn: buyIn,
        isActive: true,
        isTeamBased: isTeamBased,
        players: selectedPlayers.map(player => ({
          id: player.id,
          name: player.name,
          initialBalance: player.balance
        })),
        teams: isTeamBased ? teams : [],
        winners: [],
        teamWinners: []
      };
      
      // Update player balances
      selectedPlayers.forEach(player => {
        const playerIndex = player.id;
        const playerData = players.find(p => p.id === playerIndex);
        if (playerData) {
          playerData.balance -= buyIn;
          playerData.gamesPlayed = (playerData.gamesPlayed || 0) + 1;
        }
      });
      
      // Add to active games
      activeGames.push(newGame);
      
      // Save data
      savePlayers();
      saveActiveGames();
      
      // Update UI
      renderPlayerBalances();
      renderPlayerLeaderboard();
      checkForActiveGames();
      renderHomeActiveGame();
      renderRecentGames();
      
      // Close the modal
      document.getElementById('createGameModal').style.display = 'none';
      
      // Reset form
      document.getElementById('createGameForm').reset();
      const selectedPlayersCountElement = document.getElementById('selectedPlayersCount');
      if (selectedPlayersCountElement) selectedPlayersCountElement.textContent = '0';
      document.getElementById('gameTeamsSection').style.display = 'none';
      document.getElementById('gameTeamAssignments').innerHTML = '';
      
      // Show success message
      alert(`Game ${gameName} created successfully!`);
    }

    // Render player balances
    function renderPlayerBalances() {
      console.log('Rendering player balances', players);
      
      // Debug check - if players is empty but samplePlayers exists, use sample data
      if (!players || players.length === 0) {
        console.warn('Players array is empty in renderPlayerBalances! Using sample players as fallback.');
        players = [...samplePlayers];
      }
      
      let playersGrid = document.getElementById('playersGrid');
      
      // If the grid doesn't exist, try to find the container and create it
      if (!playersGrid) {
        console.warn('Players grid element not found! Attempting to create it.');
        const mainContainer = document.querySelector('.min-h-screen');
        
        if (mainContainer) {
          // Look for the first section which should contain the players grid
          const firstSection = mainContainer.querySelector('section');
          
          if (firstSection) {
            console.log('Found container section, creating players grid');
            // Create the grid if it doesn't exist
            playersGrid = document.createElement('div');
            playersGrid.id = 'playersGrid';
            playersGrid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4';
            
            // Find the correct place to insert the grid (after the section title)
            const sectionTitle = firstSection.querySelector('h2');
            if (sectionTitle) {
              // Insert after the title
              sectionTitle.parentNode.insertBefore(playersGrid, sectionTitle.nextSibling);
            } else {
              // Or just append to the section
              firstSection.appendChild(playersGrid);
            }
          } else {
            console.error('Could not find section to add players grid to');
            return;
          }
        } else {
          console.error('Could not find main container to add players grid to');
          return;
        }
      }
      
      console.log('Players grid found, clearing content');
      playersGrid.innerHTML = '';
      
      if (players.length === 0) {
        console.log('No players to display');
        playersGrid.innerHTML = '<div class="col-span-3 text-center py-4 text-gray-500">No players added yet</div>';
        return;
      }
      
      console.log(`Rendering ${players.length} players`);
      players.forEach((player, index) => {
        console.log(`Rendering player: ${player.name} at index ${index}`);
        const playerCard = document.createElement('div');
        
        try {
        // Use the renderPlayerWithStyle function to generate the HTML
          const cardHtml = window.renderPlayerWithStyle(player, index);
          console.log(`Card HTML generated for ${player.name}:`, cardHtml.substring(0, 50) + '...');
          playerCard.innerHTML = cardHtml;
        
        // Extract the actual div from the HTML string
        const actualCard = playerCard.firstElementChild;
          if (!actualCard) {
            console.error('Failed to create player card element for', player.name);
            return;
          }
        playersGrid.appendChild(actualCard);
          console.log(`Added card for ${player.name} to grid`);
        
        // Add event listeners to edit and delete buttons
        const editBtn = actualCard.querySelector('.edit-player-btn');
        if (editBtn) {
          editBtn.addEventListener('click', function() {
            openEditPlayerModal(index);
          });
        }
        
        const deleteBtn = actualCard.querySelector('.delete-player-btn');
        if (deleteBtn) {
          deleteBtn.addEventListener('click', function() {
            openDeletePlayerConfirmation(index);
          });
          }
        } catch (error) {
          console.error(`Error rendering player ${player.name}:`, error);
        }
      });
      console.log('Player balances rendering complete');
    }

    // Setup modal close buttons
    function setupModalCloseButtons() {
      console.log('Setting up modal close buttons');
      
      // Get all close buttons
      const closeButtons = document.querySelectorAll('.close-modal, [id$="ModalBtn"]');
      
      // Add click event to each close button
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          console.log('Close button clicked', this);
          // Find the parent modal
          const modal = this.closest('.modal');
          if (modal) {
            modal.style.display = 'none';
            
            // If this is the create game modal, reset the form
            if (modal.id === 'createGameModal') {
              document.getElementById('createGameForm').reset();
              const selectedPlayersCountElement = document.getElementById('selectedPlayersCount');
              if (selectedPlayersCountElement) selectedPlayersCountElement.textContent = '0';
              document.getElementById('gameTeamsSection').style.display = 'none';
              document.getElementById('gameTeamAssignments').innerHTML = '';
            }
          }
        });
      });
      
      // Also close modals when clicking outside
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.addEventListener('click', function(event) {
          if (event.target === this) {
            console.log('Clicked outside modal');
            this.style.display = 'none';
            
            // If this is the create game modal, reset the form
            if (this.id === 'createGameModal') {
              document.getElementById('createGameForm').reset();
              const selectedPlayersCountElement = document.getElementById('selectedPlayersCount');
              if (selectedPlayersCountElement) selectedPlayersCountElement.textContent = '0';
              document.getElementById('gameTeamsSection').style.display = 'none';
              document.getElementById('gameTeamAssignments').innerHTML = '';
            }
          }
        });
      });
    }

    // Function to replace all onclick attributes with proper event listeners
    function replaceOnClickAttributes() {
      // Find all elements with onclick attributes
      const elementsWithOnClick = document.querySelectorAll('[onclick]');
      console.log('Found elements with onclick:', elementsWithOnClick.length);
      
      elementsWithOnClick.forEach(element => {
        const onClickValue = element.getAttribute('onclick');
        console.log(`Replacing onclick attribute: ${onClickValue}`);
        
        // Extract function name and parameters
        const functionMatch = onClickValue.match(/([^\(]+)\((.*)\)/);
        if (functionMatch) {
          const functionName = functionMatch[1];
          const functionParams = functionMatch[2].split(',').map(param => {
            // Remove quotes if present
            return param.trim().replace(/^['"]|['"]$/g, '');
          });
          
          // Create a new function that calls the original function with parameters
          const newFunction = function(event) {
            event.preventDefault();
            console.log(`Executing ${functionName} with params: ${functionParams}`);
            // Check if the function exists in the global scope
            if (typeof window[functionName] === 'function') {
              // Instead of using eval, directly call the function with the parameters
              const func = window[functionName];
              switch(functionParams.length) {
                case 0:
                  func();
                  break;
                case 1:
                  func(functionParams[0]);
                  break;
                case 2:
                  func(functionParams[0], functionParams[1]);
                  break;
                case 3:
                  func(functionParams[0], functionParams[1], functionParams[2]);
                  break;
                default:
                  console.error(`Too many parameters for function ${functionName}`);
              }
            } else {
              console.error(`Function ${functionName} is not defined`);
            }
          };
          
          // Remove the onclick attribute
          element.removeAttribute('onclick');
          
          // Add the event listener
          element.addEventListener('click', newFunction);
        }
      });
    }

    // Add player management functions
    
    // Add a new player
    window.addPlayer = function(name, initialBalance) {
      console.log('Adding new player:', name, initialBalance);
      // Check if player already exists
      const playerExists = players.some(player => player.name.toLowerCase() === name.toLowerCase());
      
      if (!playerExists) {
        const newPlayerId = players.length > 0 ? Math.max(...players.map(p => p.id || 0)) + 1 : 1;
        
        players.push({
          id: newPlayerId,
          name: name,
          balance: parseFloat(initialBalance || STARTING_BALANCE),
          gamesPlayed: 0,
          gamesWon: 0,
          totalWinnings: 0,
          teamId: ''
        });
        
        savePlayers();
        renderPlayerBalances();
        renderPlayerLeaderboard();
        
        return true;
      } else {
        alert('A player with this name already exists!');
        return false;
      }
    };
    
    // Update player
    window.updatePlayer = function(index, name, balance, teamId) {
      console.log('Updating player at index:', index);
      if (index >= 0 && index < players.length) {
        // Check if the name is already taken by a different player
        const nameExists = players.some((player, idx) => 
          idx !== index && player.name.toLowerCase() === name.toLowerCase()
        );
        
        if (nameExists) {
          alert('A player with this name already exists!');
          return false;
        }
        
        const oldId = players[index].id;
        players[index].name = name;
        players[index].balance = parseFloat(balance);
        players[index].teamId = teamId || '';
        
        // Make sure the ID is preserved
        players[index].id = oldId;
        
        savePlayers();
        renderPlayerBalances();
        renderPlayerLeaderboard();
        
        return true;
      }
      return false;
    };
    
    // Delete player
    window.deletePlayer = function(index) {
      console.log('Deleting player at index:', index);
      if (index >= 0 && index < players.length) {
        // Check if player is in any active games
        const playerInGame = activeGames.some(game => 
          game.players.some(p => p.id === players[index].id)
        );
        
        if (playerInGame) {
          alert('Cannot delete a player who is in an active game!');
          return false;
        }
        
        players.splice(index, 1);
        
        savePlayers();
        renderPlayerBalances();
        renderPlayerLeaderboard();
        
        return true;
      }
      return false;
    };
    
    // View game details
    window.viewGameDetails = function(gameId) {
      console.log('Viewing game details for:', gameId);
      // Find the game by ID
      let targetGame = null;
      
      // Check active games first
      for (let i = 0; i < activeGames.length; i++) {
        if (activeGames[i].id === gameId) {
          targetGame = activeGames[i];
          break;
        }
      }
      
      // Check completed games if not found
      if (!targetGame) {
        for (let i = 0; i < games.length; i++) {
          if (games[i].id === gameId) {
            targetGame = games[i];
            break;
          }
        }
      }
      
      if (targetGame) {
        // Populate modal with game details
        const detailsContent = document.getElementById('gameDetailsContent');
        
        // Format game date
        const gameDate = new Date(targetGame.date);
        const formattedDate = `${gameDate.toLocaleDateString()} ${gameDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        
        // Get winner info
        let winnerHtml = '<span class="text-gray-500">No winner yet</span>';
        
        if (targetGame.isTeamBased && targetGame.teamWinners && targetGame.teamWinners.length > 0) {
          winnerHtml = `
            <div class="font-medium">Team: ${targetGame.teamWinners[0].name}</div>
            <div class="text-sm text-gray-600 mt-1">Team Members: ${targetGame.teamWinners[0].players.map(p => p.name).join(', ')}</div>
          `;
        } else if (targetGame.winners && targetGame.winners.length > 0) {
          winnerHtml = `<div class="font-medium">${targetGame.winners[0].name}</div>`;
        }
        
        // Generate HTML
        detailsContent.innerHTML = `
          <div class="space-y-4">
            <div class="border-b pb-2 mb-2">
              <h3 class="text-lg font-bold">${targetGame.name}</h3>
              <div class="text-sm text-gray-600">${formattedDate}</div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700">Type</label>
                <div>${targetGame.isTeamBased ? 'Team-Based' : 'Individual'}</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700">Buy-in</label>
                <div>$${targetGame.buyIn}</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700">Status</label>
                <div>${targetGame.isActive ? '<span class="text-green-600">Active</span>' : 'Completed'}</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700">Winner</label>
                <div>${winnerHtml}</div>
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">Players</label>
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mt-1">
                ${targetGame.players.map(player => `
                  <div class="bg-gray-100 p-2 rounded text-sm">${player.name}</div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
        
        // Show the modal
        document.getElementById('gameDetailsModal').style.display = 'block';
      } else {
        console.error('Game not found:', gameId);
      }
    };
    
    // Open edit player modal
    window.openEditPlayerModal = function(index) {
      console.log('Opening edit player modal for index:', index);
      currentPlayerIndex = index;
      
      if (index >= 0 && index < players.length) {
        const player = players[index];
        
        document.getElementById('editPlayerIndex').value = index;
        document.getElementById('editPlayerName').value = player.name;
        document.getElementById('editPlayerBalance').value = player.balance;
        
        // Set team dropdown
        const teamSelect = document.getElementById('editPlayerTeam');
        teamSelect.innerHTML = '<option value="">No Team</option>';
        
        teams.forEach(team => {
          const option = document.createElement('option');
          option.value = team.id;
          option.textContent = team.name;
          option.selected = (player.teamId === team.id);
          teamSelect.appendChild(option);
        });
        
        document.getElementById('editPlayerModal').style.display = 'block';
      }
    };
    
    // Open delete player confirmation
    window.openDeletePlayerConfirmation = function(index) {
      console.log('Opening delete player confirmation for index:', index);
      currentPlayerIndex = index;
      
      document.getElementById('confirmationModal').style.display = 'block';
      
      // Set up confirm button
      const confirmBtn = document.getElementById('confirmDeletePlayer');
      confirmBtn.onclick = function() {
        if (deletePlayer(currentPlayerIndex)) {
          document.getElementById('confirmationModal').style.display = 'none';
        }
      };
      
      // Set up cancel button
      const cancelBtn = document.getElementById('cancelDeletePlayer');
      cancelBtn.onclick = function() {
        document.getElementById('confirmationModal').style.display = 'none';
      };
    };
    
    // Add the event listeners for player form submissions
    var addPlayerForm = document.getElementById('addPlayerForm');
    if (addPlayerForm) {
      addPlayerForm.onsubmit = function(e) {
        e.preventDefault();
        const playerName = document.getElementById('playerName').value.trim();
        
        if (playerName) {
          if (addPlayer(playerName, STARTING_BALANCE)) {
            document.getElementById('addPlayerModal').style.display = 'none';
            addPlayerForm.reset();
          }
        } else {
          alert('Please enter a player name');
        }
      };
    }
    
    var editPlayerForm = document.getElementById('editPlayerForm');
    if (editPlayerForm) {
      editPlayerForm.onsubmit = function(e) {
        e.preventDefault();
        
        const index = document.getElementById('editPlayerIndex').value;
        const playerName = document.getElementById('editPlayerName').value.trim();
        const playerBalance = document.getElementById('editPlayerBalance').value;
        const teamId = document.getElementById('editPlayerTeam').value;
        
        if (playerName && !isNaN(playerBalance)) {
          if (updatePlayer(index, playerName, playerBalance, teamId === '' ? null : teamId)) {
            document.getElementById('editPlayerModal').style.display = 'none';
          }
        } else {
          alert('Please enter valid player information');
        }
      };
    }
    
    // Close buttons for player forms
    const cancelAddPlayerBtn = document.getElementById('cancelAddPlayer');
    if (cancelAddPlayerBtn) {
      cancelAddPlayerBtn.onclick = function() {
        document.getElementById('addPlayerModal').style.display = 'none';
        document.getElementById('addPlayerForm').reset();
      };
    }
    
    const cancelEditPlayerBtn = document.getElementById('cancelEditPlayer');
    if (cancelEditPlayerBtn) {
      cancelEditPlayerBtn.onclick = function() {
        document.getElementById('editPlayerModal').style.display = 'none';
      };
    }
  </script>
  
  <!-- Emergency fix script - directly attaches click handlers -->
  <script>
    // Execute after window loads to ensure all elements exist
    window.onload = function() {
      console.log('Window loaded - emergency initialization check');
      
      // Check if initialization already happened during DOMContentLoaded
      if (typeof players === 'undefined' || players.length === 0) {
        console.log('No players found, running emergency initialization');
      // Initialize the application
      loadPlayers();
      loadTeams();
      loadGames();
      loadActiveGames();
      
      // Render UI components
      renderPlayerBalances();
      renderPlayerLeaderboard();
      renderRecentGames();
      checkForActiveGames();
      } else {
        console.log('Players already loaded:', players.length);
      }
    };
  </script>
</body>
</html> 